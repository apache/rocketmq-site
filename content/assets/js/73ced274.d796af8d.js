"use strict";(self.webpackChunkrocketmq_docs=self.webpackChunkrocketmq_docs||[]).push([[7679],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),u=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=u(e.components);return a.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),p=u(n),g=r,m=p["".concat(c,".").concat(g)]||p[g]||d[g]||o;return n?a.createElement(m,l(l({ref:t},s),{},{components:n})):a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=g;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[p]="string"==typeof e?e:r,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(67294),r=n(86010);const o="tabItem_Ymn6";function l(e){let{children:t,hidden:n,className:l}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,l),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>E});var a=n(87462),r=n(67294),o=n(86010),l=n(12466),i=n(16550),c=n(91980),u=n(67392),s=n(50012);function p(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function d(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function g(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const a=(0,i.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,c._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=d(e),[l,i]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!g({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[c,u]=m({queryString:n,groupId:a}),[p,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,s.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),h=(()=>{const e=c??p;return g({value:e,tabValues:o})?e:null})();(0,r.useEffect)((()=>{h&&i(h)}),[h]);return{selectedValue:l,selectValue:(0,r.useCallback)((e=>{if(!g({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),f(e)}),[u,f,o]),tabValues:o}}var h=n(72389);const k="tabList__CuJ",b="tabItem_LNqP";function v(e){let{className:t,block:n,selectedValue:i,selectValue:c,tabValues:u}=e;const s=[],{blockElementScrollPositionUntilNextRender:p}=(0,l.o5)(),d=e=>{const t=e.currentTarget,n=s.indexOf(t),a=u[n].value;a!==i&&(p(t),c(a))},g=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=s.indexOf(e.currentTarget)+1;t=s[n]??s[0];break}case"ArrowLeft":{const n=s.indexOf(e.currentTarget)-1;t=s[n]??s[s.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:l}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>s.push(e),onKeyDown:g,onClick:d},l,{className:(0,o.Z)("tabs__item",b,l?.className,{"tabs__item--active":i===t})}),n??t)})))}function y(e){let{lazy:t,children:n,selectedValue:a}=e;if(t){const e=n.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},n.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function N(e){const t=f(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",k)},r.createElement(v,(0,a.Z)({},e,t)),r.createElement(y,(0,a.Z)({},e,t)))}function E(e){const t=(0,h.Z)();return r.createElement(N,(0,a.Z)({key:String(t)},e))}},12883:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>c,default:()=>g,frontMatter:()=>i,metadata:()=>u,toc:()=>p});var a=n(87462),r=(n(67294),n(3905)),o=n(74866),l=n(85162);const i={},c="Log configuration",u={unversionedId:"bestPractice/20log",id:"bestPractice/20log",title:"Log configuration",description:"Client logs are used to record exceptions that occur during the client's operation, helping to quickly locate and fix problems. This article introduces the way to print RocketMQ client logs and the default and custom configurations.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/05-bestPractice/20log.md",sourceDirName:"05-bestPractice",slug:"/bestPractice/20log",permalink:"/docs/4.x/bestPractice/20log",draft:!1,editUrl:"https://github.com/apache/rocketmq-site/tree/new-official-website/docs/05-bestPractice/20log.md",tags:[],version:"current",frontMatter:{},sidebar:"myAutogeneratedSidebar",previous:{title:"JVM/OS Configuration",permalink:"/docs/4.x/bestPractice/19JVMOS"},next:{title:"Consistent subscription relationship",permalink:"/docs/4.x/bestPractice/21subscribe"}},s={},p=[{value:"Printing Client Log",id:"printing-client-log",level:2},{value:"1: Depend on log4j as the log implementation",id:"1-depend-on-log4j-as-the-log-implementation",level:3},{value:"2: Depend on logback as the log implementation",id:"2-depend-on-logback-as-the-log-implementation",level:3},{value:"Client log configuration",id:"client-log-configuration",level:2},{value:"Default configuration",id:"default-configuration",level:2},{value:"Custom configuration",id:"custom-configuration",level:2},{value:"Example",id:"example",level:2}],d={toc:p};function g(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"log-configuration"},"Log configuration"),(0,r.kt)("p",null,"Client logs are used to record exceptions that occur during the client's operation, helping to quickly locate and fix problems. This article introduces the way to print RocketMQ client logs and the default and custom configurations."),(0,r.kt)("h2",{id:"printing-client-log"},"Printing Client Log"),(0,r.kt)("p",null,"RocketMQ's TCP Java SDK is programmed using the SLF4J interface."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For Java SDK version 1.7.8.Final and above")),(0,r.kt)("p",null,"RocketMQ's Java SDK version 1.7.8.Final already has built-in log implementation and no log implementation dependency needs to be added in the client application to print RocketMQ client logs. For more information on default configuration and how to change it, refer to the client log configuration section below."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For Java SDK version 1.7.8.Final and below")),(0,r.kt)("p",null,"Older versions of RocketMQ's Java SDK prior to version 1.7.8.Final do not support log4j2 and only support log4j and logback. You will need to add the corresponding log implementation dependency in the pom.xml configuration file or in the lib to print RocketMQ client logs."),(0,r.kt)("h3",{id:"1-depend-on-log4j-as-the-log-implementation"},"1: Depend on log4j as the log implementation"),(0,r.kt)("p",null,"Example code for depending on log4j or logback as the log implementation is shown below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency> \n  <groupId>org.slf4j</groupId> \n  <artifactId>jcl-over-slf4j</artifactId> \n  <version>1.7.7</version>\n</dependency> \n<dependency>\n  <groupId>org.slf4j</groupId>\n  <artifactId>slf4j-log4j12</artifactId>\n  <version>1.7.7</version>\n</dependency> \n<dependency>\n  <groupId>log4j</groupId> \n  <artifactId>log4j</artifactId>\n  <version>1.2.17</version> \n</dependency>\n")),(0,r.kt)("p",null,"When using log4j property configuration file, configure it as follows."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"log4j.appender.mq=org.apache.rocketmq.logappender.log4j.RocketmqLog4jAppender \nlog4j.appender.mq.Tag=yourTag \nlog4j.appender.mq.Topic=yourLogTopic \nlog4j.appender.mq.ProducerGroup=yourLogGroup \nlog4j.appender.mq.NameServerAddress=yourRocketmqNameserverAddress \nlog4j.appender.mq.layout=org.apache.log4j.PatternLayout \nlog4j.appender.mq.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %-4r [%t] (%F:%L) %-5p - %m%n \n")),(0,r.kt)("p",null,"When using log4j xml configuration file, configure it as such and add an asynchronous appender:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<appender name="mqAppender1" class="org.apache.rocketmq.logappender.log4j.RocketmqLog4jAppender">\n    <param name="Tag" value="yourTag" />\n    <param name="Topic" value="yourLogTopic" />\n    <param name="ProducerGroup" value="yourLogGroup" />\n    <param name="NameServerAddress" value="yourRocketmqNameserverAddress"/>\n    <layout class="org.apache.log4j.PatternLayout">\n        <param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss}-%p %t %c - %m%n" />\n    </layout>\n</appender>\n\n<appender name="mqAsyncAppender1" class="org.apache.log4j.AsyncAppender">\n    <param name="BufferSize" value="1024" />\n    <param name="Blocking" value="false" />\n    <appender-ref ref="mqAppender1"/>\n</appender>\n')),(0,r.kt)("p",null,"When using log4j2, configure it as this. If you want noneblock, simply configure a asyncAppender for ref."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<RocketMQ name="rocketmqAppender" producerGroup="yourLogGroup" nameServerAddress="yourRocketmqNameserverAddress"\n     topic="yourLogTopic" tag="yourTag">\n    <PatternLayout pattern="%d [%p] hahahah %c %m%n"/>\n</RocketMQ>\n')),(0,r.kt)("h3",{id:"2-depend-on-logback-as-the-log-implementation"},"2: Depend on logback as the log implementation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency> \n  <groupId>ch.qos.logback</groupId> \n  <artifactId>logback-core</artifactId> \n  <version>1.1.2</version>\n</dependency> \n<dependency>\n  <groupId>ch.qos.logback</groupId>\n  <artifactId>logback-classic</artifactId> \n  <version>1.1.2</version> \n</dependency>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency> \n  <groupId>ch.qos.logback</groupId> \n  <artifactId>logback-core</artifactId> \n  <version>1.1.2</version>\n</dependency> \n<dependency>\n  <groupId>ch.qos.logback</groupId>\n  <artifactId>logback-classic</artifactId> \n  <version>1.1.2</version> \n</dependency>\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Having both log4j and logback log implementations in the application will cause log conflicts and result in confusion in client log printing. Make sure the application only depends on one log implementation, which is the prerequisite for correctly printing RocketMQ client logs. It is recommended to check this using the command ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"mvn clean dependency:tree | grep log")),".")),(0,r.kt)("h2",{id:"client-log-configuration"},"Client log configuration"),(0,r.kt)("p",null,"The RocketMQ client supports customizing the log save path, log level, and maximum number of historical log files to save. To ensure convenience in log transfer and reading, customizing the size of a single log file is currently not allowed and remains at the default of 64 MB. The configuration instructions for each parameter are as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Explain"),(0,r.kt)("th",{parentName:"tr",align:null},"Configuration parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Custom value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Log save path"),(0,r.kt)("td",{parentName:"tr",align:null},"Please make sure that the application process has write permission to the specified path, otherwise the log will not be printed."),(0,r.kt)("td",{parentName:"tr",align:null},"rocketmq.client.logRoot"),(0,r.kt)("td",{parentName:"tr",align:null},"You can customize the path where you want to save the log files locally. Please make sure that your application process has write permission to that path, otherwise the log will not be printed.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Maximum number of historical log files to save"),(0,r.kt)("td",{parentName:"tr",align:null},"The supported value range is between 1 to 100; if the input value is outside of this range or in the wrong format, the system will default to saving 10 logs."),(0,r.kt)("td",{parentName:"tr",align:null},"rocketmq.client.logFileMaxIndex"),(0,r.kt)("td",{parentName:"tr",align:null},"The value range is 1~100. If the value set is out of range or in the wrong format, the default value (10) will be used.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Log level"),(0,r.kt)("td",{parentName:"tr",align:null},"The supported log levels are ERROR, WARN, INFO, DEBUG, if no match is found the default is INFO."),(0,r.kt)("td",{parentName:"tr",align:null},"rocketmq.client.logLevel"),(0,r.kt)("td",{parentName:"tr",align:null},"Values\uff1a",(0,r.kt)("strong",{parentName:"td"},"ERROR WARN INFO DEBUG"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Size of a single log file"),(0,r.kt)("td",{parentName:"tr",align:null},"Support specifying in bytes"),(0,r.kt)("td",{parentName:"tr",align:null},"rocketmq.client.logFileMaxSize"),(0,r.kt)("td",{parentName:"tr",align:null},"The value range is 0~1GB, the default is 1GB, it is recommended to use 64 MB")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Whether to use parent logger to print logback"),(0,r.kt)("td",{parentName:"tr",align:null},"Whether children-logger use the appender configured by rootLogger for output"),(0,r.kt)("td",{parentName:"tr",align:null},"rocketmq.client.log.additive"),(0,r.kt)("td",{parentName:"tr",align:null},"true/false")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Use the project's slf4j implementation to record logs"),(0,r.kt)("td",{parentName:"tr",align:null},"If need to implement log recording, set it to true"),(0,r.kt)("td",{parentName:"tr",align:null},"rocketmq.client.logUseSlf4j"),(0,r.kt)("td",{parentName:"tr",align:null},"true/flase")))),(0,r.kt)("h2",{id:"default-configuration"},"Default configuration"),(0,r.kt)("p",null,"Please make sure that the application process has write permission to the specified path, otherwise the log will not be printed. The supported value range is between 1 to 100; if the input value is outside of this range or in the wrong format, the system will default to saving 10 logs. The supported log levels are ERROR, WARN, INFO, DEBUG, if no match is found the default is INFO."),(0,r.kt)("p",null,"When the RocketMQ client starts, log files will be generated according to the following default configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Log save path: ",(0,r.kt)("inlineCode",{parentName:"li"},"/{user.home}/logs/rocketmqlogs/"),", where ",(0,r.kt)("inlineCode",{parentName:"li"},"{user.home}")," refers to the root directory of the user who starts the current Java process"),(0,r.kt)("li",{parentName:"ul"},"Maximum number of historical log files to save: 10"),(0,r.kt)("li",{parentName:"ul"},"Log level: INFO"),(0,r.kt)("li",{parentName:"ul"},"Size of a single log file: 1GB\t\t")),(0,r.kt)("h2",{id:"custom-configuration"},"Custom configuration"),(0,r.kt)("p",null,"If need to customize the configuration, refer to the static variable definition of ClientLogger, and the parameter meaning aligns with the client configuration above."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    public static final String CLIENT_LOG_USESLF4J = "rocketmq.client.logUseSlf4j";\n    public static final String CLIENT_LOG_ROOT = "rocketmq.client.logRoot";\n    public static final String CLIENT_LOG_MAXINDEX = "rocketmq.client.logFileMaxIndex";\n    public static final String CLIENT_LOG_FILESIZE = "rocketmq.client.logFileMaxSize";\n    public static final String CLIENT_LOG_LEVEL = "rocketmq.client.logLevel";\n    public static final String CLIENT_LOG_ADDITIVE = "rocketmq.client.log.additive";\n    public static final String CLIENT_LOG_FILENAME = "rocketmq.client.logFileName";\n    public static final String CLIENT_LOG_ASYNC_QUEUESIZE = "rocketmq.client.logAsyncQueueSize";\n    public static final String ROCKETMQ_CLIENT_APPENDER_NAME = "RocketmqClientAppender";\n\n    private static final InternalLogger CLIENT_LOGGER;\n\n    private static final boolean CLIENT_USE_SLF4J;\n\n    //private static Appender rocketmqClientAppender = null;\n\n    static {\n        CLIENT_USE_SLF4J = Boolean.parseBoolean(System.getProperty(CLIENT_LOG_USESLF4J, "false"));\n        if (!CLIENT_USE_SLF4J) {\n            InternalLoggerFactory.setCurrentLoggerType(InnerLoggerFactory.LOGGER_INNER);\n            CLIENT_LOGGER = createLogger(LoggerName.CLIENT_LOGGER_NAME);\n            createLogger(LoggerName.COMMON_LOGGER_NAME);\n            createLogger(RemotingHelper.ROCKETMQ_REMOTING);\n        } else {\n            CLIENT_LOGGER = InternalLoggerFactory.getLogger(LoggerName.CLIENT_LOGGER_NAME);\n        }\n    }\n')),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,"Below is a simple example"),(0,r.kt)("p",null,"Add the following system parameters in the startup script or IDE's VM options:"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"Linux Example",label:"Linux Example",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"-Drocketmq.client.logRoot=/home/admin/logs -Drocketmq.client.logLevel=WARN -Drocketmq.client.logFileMaxIndex=20  -Drocketmq.client.logFileMaxSize=67108864\n"))),(0,r.kt)(l.Z,{value:"windows Example",label:"windows Example",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"-Drocketmq.client.logRoot=D:\\logs -Drocketmq.client.logLevel=WARN -Drocketmq.client.logFileMaxIndex=20 -Drocketmq.client.logFileMaxSize=67108864\n")))))}g.isMDXComponent=!0}}]);