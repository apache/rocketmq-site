"use strict";(self.webpackChunkrocketmq_docs=self.webpackChunkrocketmq_docs||[]).push([[4234],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var r=n(67294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,i=e.originalType,c=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),m=l(n),d=s,h=m["".concat(c,".").concat(d)]||m[d]||p[d]||i;return n?r.createElement(h,o(o({ref:t},u),{},{components:n})):r.createElement(h,o({ref:t},u))}));function d(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=n.length,o=new Array(i);o[0]=m;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a.mdxType="string"==typeof e?e:s,o[1]=a;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},33879:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var r=n(87462),s=(n(67294),n(3905));const i={},o="Subscription",a={unversionedId:"domainModel/09subscription",id:"version-5.0/domainModel/09subscription",title:"Subscription",description:"This section describes the definition, model relationship, internal attributes, and usage notes for subscriptions in Apache RocketMQ.",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-5.0/03-domainModel/09subscription.md",sourceDirName:"03-domainModel",slug:"/domainModel/09subscription",permalink:"/docs/domainModel/09subscription",draft:!1,editUrl:"https://github.com/apache/rocketmq-site/tree/new-official-website/versioned_docs/version-5.0/03-domainModel/09subscription.md",tags:[],version:"5.0",frontMatter:{},sidebar:"version-5.0/myAutogeneratedSidebar",previous:{title:"Consumer",permalink:"/docs/domainModel/08consumer"},next:{title:"Normal Message",permalink:"/docs/featureBehavior/01normalmessage"}},c={},l=[{value:"Definition",id:"definition",level:2},{value:"Rules for determining a subscription",id:"rules-for-determining-a-subscription",level:2},{value:"Model relationship",id:"model-relationship",level:2},{value:"Internal attributes",id:"internal-attributes",level:2},{value:"Behavior constraints",id:"behavior-constraints",level:2},{value:"Usage notes",id:"usage-notes",level:2}],u={toc:l};function p(e){let{components:t,...i}=e;return(0,s.kt)("wrapper",(0,r.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"subscription"},"Subscription"),(0,s.kt)("p",null,"This section describes the definition, model relationship, internal attributes, and usage notes for subscriptions in Apache RocketMQ."),(0,s.kt)("h2",{id:"definition"},"Definition"),(0,s.kt)("p",null,"A subscription is the rule and status settings for consumers to obtain and process messages in Apache RocketMQ."),(0,s.kt)("p",null,"Subscriptions are dynamically registered by consumer groups with brokers. Messages are then matched and consumed based on the filter rules defined by subscriptions."),(0,s.kt)("p",null,"By configuring subscriptions, you can control the following messaging behaviors:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Message filter rules: These rules are used to define which messages in a topic are consumed by a consumer. By configuring message filter rules, consumers can effectively obtain messages that they want and specify message receiving ranges based on different business scenarios. For more information, see ",(0,s.kt)("a",{parentName:"p",href:"/docs/featureBehavior/07messagefilter"},"Message filtering"),".")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Consumption status: By default, the Apache RocketMQ broker provides persistent subscriptions. In other words, after a consumer group subscribes to a broker, consumers in the group can continue consuming messages from where the consumers left off after they reconnect."))),(0,s.kt)("h2",{id:"rules-for-determining-a-subscription"},"Rules for determining a subscription"),(0,s.kt)("p",null,"The subscriptions of Apache RocketMQ are designed based on consumer groups and topics. Therefore, a subscription refers to the subscription of a specified consumer group to a topic. The following describes the rules for determining a subscription:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"One topic to many subscribersThe following figure shows two consumer groups (Group A and Group B) subscribed to Topic A. These two subscriptions are independent of each other and can be defined separately.\n",(0,s.kt)("img",{alt:"\u8ba2\u9605\u5173\u7cfb\u4e0d\u540c\u5206\u7ec4",src:n(85493).Z,width:"1193",height:"737"}))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"One subscriber to multiple topicsThe following figure shows a consumer group (Group A) subscribed to two topics: Topic A and Topic B. Consumers in Group A have two separate subscriptions to Topic A and Topic B. The two subscriptions are independent of each other and can be defined separately.\n",(0,s.kt)("img",{alt:"\u8ba2\u9605\u5173\u7cfb\u76f8\u540c\u5206\u7ec4",src:n(49153).Z,width:"1345",height:"466"})))),(0,s.kt)("h2",{id:"model-relationship"},"Model relationship"),(0,s.kt)("p",null,"The following figure shows the position of subscriptions in the domain model of Apache RocketMQ.",(0,s.kt)("img",{alt:"Subscriptions",src:n(74569).Z,width:"1977",height:"877"})),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"The message is initialized by the producer and sent to the Apache RocketMQ server.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Messages are stored in the specified queue of the topic in the order in which they arrive at the Apache RocketMQ server.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"The consumer obtains and consumes messages from the Apache RocketMQ server based on the specified subscription relationship."))),(0,s.kt)("h2",{id:"internal-attributes"},"Internal attributes"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Filter types")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Definition: the type of a message filter rule. After a message filter rule is set for a subscription, the system matches the messages in a topic based on the filter rule. Only the messages that meet the conditions are delivered to consumers. This feature helps you classify messages sent to consumers based on your requirements.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Values:"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Tag filter: filters and matches the full text based on tag strings.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"SQL92 filter: filters and matches message attributes based on SQL syntax."))))),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Filter expressions")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Definition: the expression of a custom filter rule.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Values: For more information, see ",(0,s.kt)("a",{parentName:"p",href:"/docs/featureBehavior/07messagefilter"},"Syntax for filter expressions"),"."))),(0,s.kt)("h2",{id:"behavior-constraints"},"Behavior constraints"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Subscription consistency")),(0,s.kt)("p",null,"Apache RocketMQ manages subscriptions based on consumer groups. Therefore, consumers in the same consumer group must maintain the same consumption logic. Otherwise, consumption conflicts occur, which in turn causes some messages to be incorrectly consumed."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Correct example"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-java"},'//Consumer c1\nConsumer c1 = ConsumerBuilder.build(groupA);\nc1.subscribe(topicA,"TagA");\n//Consumer c2\nConsumer c2 = ConsumerBuilder.build(groupA);\nc1.subscribe(topicA,"TagA");\n')))),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Incorrect example"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-java"},'//Consumer c1\nConsumer c1 = ConsumerBuilder.build(groupA);\nc1.subscribe(topicA,"TagA");\n//Consumer c2Consumer \nc2 = ConsumerBuilder.build(groupA);\nc1.subscribe(topicA,"TagB");\n')))),(0,s.kt)("h2",{id:"usage-notes"},"Usage notes"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Do not frequently modify subscriptions.")),(0,s.kt)("p",null,"In Apache RocketMQ, subscriptions are associated with metadata and configurations such as filter rules and consumption progress. The system must also ensure that the consumption behavior, consumption logic, and load policy of all consumers in the consumer group are consistent. These factors result in a complex web of relationships that need to be managed. Therefore, we recommend that you do not regularly modify subscriptions to change the business logic in the production environment. Otherwise, the client constantly needs to adjust its load distribution, which causes message reception problems."))}p.isMDXComponent=!0},74569:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/archiforsubsciption-a495c04e71ed64b9403b689f9413ed08.png"},85493:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/subscription_diff_group-0b215b9bb822b4bf43c388e9155ecca1.png"},49153:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/subscription_one_group-77bd92b987e8264ad3c5f27b29463942.png"}}]);