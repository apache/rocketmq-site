<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>RocketMQ JVM/Linux Configuration - Apache RocketMQ</title>




<meta name="description" content="This is an introduction for configuring RocketMQ broker JVM/OS parameters. It points out certain specified configurations that should be thinking about before deploying RocketMQ cluster.">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Apache RocketMQ">
<meta property="og:title" content="RocketMQ JVM/Linux Configuration">




  <meta property="og:description" content="This is an introduction for configuring RocketMQ broker JVM/OS parameters. It points out certain specified configurations that should be thinking about before deploying RocketMQ cluster.">



  <meta name="twitter:site" content="@ApacheRocketMQ">
  <meta name="twitter:title" content="RocketMQ JVM/Linux Configuration">
  <meta name="twitter:description" content="This is an introduction for configuring RocketMQ broker JVM/OS parameters. It points out certain specified configurations that should be thinking about before deploying RocketMQ cluster.">
  <meta name="twitter:url" content="">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2018-11-05T16:44:23+08:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Apache RocketMQ",
      "url" : null,
      "sameAs" : null
    }
  </script>



  <meta name="google-site-verification" content="aand0XZkSGsziuC-UPD4ZJniFD0m0JhGx6820y2mAQY" />


  <meta name="baidu-site-verification" content="wD06EbDRkQ" />




<!-- end SEO -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Apache RocketMQ Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="/">Apache RocketMQ</a></li>
          
            
            <li class="masthead__menu-item"><a href="/docs/quick-start/">Documentation</a></li>
          
            
            <li class="masthead__menu-item"><a href="/year-archive/">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="/community/">Community</a></li>
          
            
            <li class="masthead__menu-item"><a href="/users/">Users</a></li>
          
            
            <li class="masthead__menu-item"><a href="/about/team/">About</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">User Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/motivation/" class="">Why RocketMQ</a></li>
          
            
            

            
            

            <li><a href="/docs/quick-start/" class="">Quick Start</a></li>
          
            
            

            
            

            <li><a href="/docs/simple-example/" class="">Simple Example</a></li>
          
            
            

            
            

            <li><a href="/docs/order-example/" class="">Order Example</a></li>
          
            
            

            
            

            <li><a href="/docs/broadcast-example/" class="">Broadcasting Example</a></li>
          
            
            

            
            

            <li><a href="/docs/schedule-example/" class="">Schedule Example</a></li>
          
            
            

            
            

            <li><a href="/docs/batch-example/" class="">Batch Example</a></li>
          
            
            

            
            

            <li><a href="/docs/filter-by-sql92-example/" class="">Filter Example</a></li>
          
            
            

            
            

            <li><a href="/docs/logappender-example/" class="">Logappender Example</a></li>
          
            
            

            
            

            <li><a href="/docs/openmessaging-example/" class="">OpenMessaging Example</a></li>
          
            
            

            
            

            <li><a href="/docs/transaction-example/" class="">Transaction Example</a></li>
          
            
            

            
            

            <li><a href="/docs/faq/" class="">FAQ</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Deployment & Operations</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/rmq-arc/" class="">Architecture</a></li>
          
            
            

            
            

            <li><a href="/docs/rmq-deployment/" class="">Deployment</a></li>
          
            
            

            
            

            <li><a href="/docs/cli-admin-tool/" class="">CLI Admin Tool</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contributor Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/how-to-contribute/" class="">How To Contribute</a></li>
          
            
            

            
            

            <li><a href="/docs/code-guidelines/" class="">Code Guidelines</a></li>
          
            
            

            
            

            <li><a href="/docs/pull-request/" class="">Manage Pull Request</a></li>
          
            
            

            
            

            <li><a href="/docs/release-manual" class="">Release Manual</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Best Practice</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/core-concept/" class="">Core Concept</a></li>
          
            
            

            
            

            <li><a href="/docs/best-practice-broker/" class="">Broker</a></li>
          
            
            

            
            

            <li><a href="/docs/best-practice-producer/" class="">Producer</a></li>
          
            
            

            
            

            <li><a href="/docs/best-practice-consumer/" class="">Consumer</a></li>
          
            
            

            
            

            <li><a href="/docs/best-practice-namesvr/" class="">NameServer</a></li>
          
            
            

            
            

            <li><a href="/docs/system-config/" class="active">JVM/Kernel Config</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Release Notes</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/dowloading/releases/" class="">Download</a></li>
          
            
            

            
            

            <li><a href="/release_notes/release-notes-4.3.2/" class="">4.3.2</a></li>
          
            
            

            
            

            <li><a href="/release_notes/release-notes-4.3.1/" class="">4.3.1</a></li>
          
            
            

            
            

            <li><a href="/release_notes/release-notes-4.3.0/" class="">4.3.0</a></li>
          
            
            

            
            

            <li><a href="/release_notes/release-notes-4.2.0/" class="">4.2.0</a></li>
          
            
            

            
            

            <li><a href="/release_notes/release-notes-4.1.0-incubating/" class="">4.1.0-incubating</a></li>
          
            
            

            
            

            <li><a href="/release_notes/release-notes-4.0.0-incubating/" class="">4.0.0-incubating</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/docs/roadmap/"><span class="nav__sub-title">RoadMap</span></a>
        

        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="RocketMQ JVM/Linux Configuration">
    <meta itemprop="description" content="This is an introduction for configuring RocketMQ broker JVM/OS parameters. It points out certain specified configurations that should be thinking about before deploying RocketMQ cluster.">
    <meta itemprop="datePublished" content="November 05, 2018">
    <meta itemprop="dateModified" content="July 15, 2017">

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">RocketMQ JVM/Linux Configuration
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>This is an introduction for configuring RocketMQ broker JVM/OS parameters. It points out certain specified configurations that should be thinking about before deploying RocketMQ cluster.</p>

<aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-file-text"></i> On This Page</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#jvm-options" id="markdown-toc-jvm-options">JVM Options</a></li>
  <li><a href="#linux-kernel-parameters" id="markdown-toc-linux-kernel-parameters">Linux Kernel Parameters</a></li>
  <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
</ul>

  </nav>
</aside>

<h1 id="jvm-options">JVM Options</h1>

<p>The latest released version of JDK 1.8 is recommended, with server compiler and a 8g heap. Set the same Xms and Xmx value to prevent the JVM from resizing the heap for better performance. A simple JVM configurations looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-server -Xms8g -Xmx8g -Xmn4g
</code></pre>
</div>

<p>If you don’t care about the boot time of RocketMQ broker, pre-touch the Java heap to make sure that every page will be allocated during JVM initialization is a better choice. Those who don’t care about the boot time can enable it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-XX:+AlwaysPreTouch
</code></pre>
</div>

<p>Disable biased locking may reduce JVM pauses:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-XX:-UseBiasedLocking
</code></pre>
</div>

<p>As for garbage collection, G1 collector with JDK 1.8 is recommended:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-XX:+UseG1GC -XX:G1HeapRegionSize=16m -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30
</code></pre>
</div>

<p>These GC options looks a little aggressive, but it’s proved to have good performance in our production environment.</p>

<p>Don’t set a too small value for <code class="highlighter-rouge">-XX:MaxGCPauseMillis</code>, otherwise JVM will use a small young generation to achieve this goal which will cause very frequent minor GC.</p>

<p>And use rolling GC log file is recommended:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=30m
</code></pre>
</div>

<p>If write GC file will increase latency of broker, consider redirect GC log file to a memory file system:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-Xloggc:/dev/shm/mq_gc_%p.log
</code></pre>
</div>

<h1 id="linux-kernel-parameters">Linux Kernel Parameters</h1>

<p>There is a <code class="highlighter-rouge">os.sh</code> script that lists a lot of kernel parameters in folder <code class="highlighter-rouge">bin</code> which can be used for production use with minor changes. Below parameters need attention, and more details please refer to documentation for /proc/sys/vm/*[1].</p>

<p><strong>vm.extra_free_kbytes</strong>, tells the VM to keep extra free memory between the threshold where background reclaim (kswapd) kicks in, and the threshold where direct reclaim (by allocating processes) kicks in. RocketMQ uses this parameter to avoid high latency in memory allocation.</p>

<p><strong>vm.min_free_kbytes</strong>, if you set this to lower than 1024KB, your system will
become subtly broken, and prone to deadlock under high loads.</p>

<p><strong>vm.max_map_count</strong>, limits the maximum number of memory map areas a process
may have. RocketMQ will use mmap to load CommitLog and ConsumeQueue, so set a bigger value for this parameter is recommended.</p>

<p><strong>vm.swappiness</strong>, define how aggressive the kernel will swap memory pages. Higher values will increase agressiveness, lower values decrease the amount of swap. 10 for this value to avoid swap latency is recommended.</p>

<p><strong>File descriptor limits</strong>, RocketMQ needs open file descriptors for files(CommitLog and ConsumeQueue) and network connections. We recommend set 655350 for file descriptors.</p>

<p><strong>Disk scheduler</strong>, the deadline I/O scheduler is recommended for RocketMQ, which attempts to provide a guaranteed latency for requests[2].</p>

<h1 id="reference">Reference</h1>
<ol>
  <li>https://www.kernel.org/doc/Documentation/sysctl/vm.txt</li>
  <li>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/ch06s04s02.html</li>
</ol>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-07-15">July 15, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=ApacheRocketMQ&text=RocketMQ JVM/Linux Configuration /docs/system-config/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=/docs/system-config/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=/docs/system-config/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=/docs/system-config/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/docs/openmessaging-example/" class="pagination--pager" title="OpenMessaging Example
">Previous</a>
    
    
      <a href="/docs/how-to-contribute/" class="pagination--pager" title="How to Contribute
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <style type="text/css">
  div.columns   { float: left; margin-left: 10px;}
  div.clear     { clear: both; } 
</style>
<div>
  <div class="columns">
    <a href="https://www.apache.org/"><img src="/assets/images/feather-small.gif" alt="Apache Software Foundation" style="height: 88px !important" /></a>
  </div>
  <div class="columns" style="width: 80%">
    <div class="page__footer-follow">
      <ul class="social-icons">
        
          <li><strong>Follow:</strong></li>
        
        
          <li><a href="https://twitter.com/ApacheRocketMQ"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
        
        
          <li><a href="https://github.com/apache/rocketmq"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
        
        <li><a href="/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
      </ul>
    </div>

    <div class="page__footer-copyright">Copyright &copy; 2018 <a href="http://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0.</a></div>
    <div class="page__footer-copyright">Apache RocketMQ, RocketMQ, Apache, the Apache feather logo and the Apache RocketMQ logo are trademarks of The Apache Software Foundation.</div>
    <br>
    <div class="page__footer-copyright"><a href="https://www.apache.org/licenses/">License</a> | <a href="https://www.apache.org/security/">Security</a> | <a href="https://www.apache.org/foundation/thanks.html">Thanks</a> | <a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></div>
    <br>
	<div>
      <a  href="https://www.apache.org/events/current-event.html">
        <img src="https://www.apache.org/events/current-event-234x60.png" />
      </a>
    </div>
  </div>
</div>
<div class="clear"></div>
      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89603173-1', 'auto');
  ga('send', 'pageview');
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?36428f2b841d08e7405724cbf7f860d2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'rocketmq';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
