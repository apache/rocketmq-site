<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Filter By SQL92 Example  - Apache RocketMQ</title>




<meta name="description" content="How to filter messages by SQL92 in Apache RocketMQ.">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Apache RocketMQ">
<meta property="og:title" content="Filter By SQL92 Example">




  <meta property="og:description" content="How to filter messages by SQL92 in Apache RocketMQ.">



  <meta name="twitter:site" content="@ApacheRocketMQ">
  <meta name="twitter:title" content="Filter By SQL92 Example">
  <meta name="twitter:description" content="How to filter messages by SQL92 in Apache RocketMQ.">
  <meta name="twitter:url" content="">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-04-26T17:11:09+08:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Apache RocketMQ",
      "url" : null,
      "sameAs" : null
    }
  </script>



  <meta name="google-site-verification" content="aand0XZkSGsziuC-UPD4ZJniFD0m0JhGx6820y2mAQY" />


  <meta name="baidu-site-verification" content="wD06EbDRkQ" />




<!-- end SEO -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Apache RocketMQ Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="/">Apache RocketMQ</a></li>
          
            
            <li class="masthead__menu-item"><a href="/docs/quick-start/">Documentation</a></li>
          
            
            <li class="masthead__menu-item"><a href="/year-archive/">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="/community/">Community</a></li>
          
            
            <li class="masthead__menu-item"><a href="/customer/">Customer</a></li>
          
            
            <li class="masthead__menu-item"><a href="/about/team/">About</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">User Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/quick-start/" class="">Quick Start</a></li>
          
            
            

            
            

            <li><a href="/docs/motivation/" class="">Why RocketMQ</a></li>
          
            
            

            
            

            <li><a href="/docs/simple-example/" class="">Simple Example</a></li>
          
            
            

            
            

            <li><a href="/docs/order-example/" class="">Order Example</a></li>
          
            
            

            
            

            <li><a href="/docs/broadcast-example/" class="">Broadcasting Example</a></li>
          
            
            

            
            

            <li><a href="/docs/schedule-example/" class="">Schedule Example</a></li>
          
            
            

            
            

            <li><a href="/docs/batch-example/" class="">Batch Example</a></li>
          
            
            

            
            

            <li><a href="/docs/filter-by-sql92-example/" class="active">Filter By SQL92 Example</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Deployment & Operations</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/rmq-arc/" class="">Architecture</a></li>
          
            
            

            
            

            <li><a href="/docs/rmq-deployment/" class="">Deployment</a></li>
          
            
            

            
            

            <li><a href="/docs/cli-admin-tool/" class="">CLI Admin Tool</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contributor Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/code-guidelines/" class="">Code Guidelines</a></li>
          
            
            

            
            

            <li><a href="/docs/pull-request/" class="">Pull Request</a></li>
          
            
            

            
            

            <li><a href="/docs/release-manual" class="">Release Manual</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Best Practice</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/core-concept/" class="">Core Concept</a></li>
          
            
            

            
            

            <li><a href="/docs/best-practice-broker/" class="">Broker</a></li>
          
            
            

            
            

            <li><a href="/docs/best-practice-producer/" class="">Producer</a></li>
          
            
            

            
            

            <li><a href="/docs/best-practice-consumer/" class="">Consumer</a></li>
          
            
            

            
            

            <li><a href="/docs/best-practice-namesvr/" class="">NameServer</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Release Notes</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/dowloading/releases/" class="">Download</a></li>
          
            
            

            
            

            <li><a href="/release_notes/release-notes-4.0.0-incubating/" class="">4.0.0-incubating</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/docs/roadmap/"><span class="nav__sub-title">RoadMap</span></a>
        

        
      </li>
    
      <li>
        
          
          

          <a href="/docs/faq/"><span class="nav__sub-title">FAQ</span></a>
        

        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Filter By SQL92 Example">
    <meta itemprop="description" content="How to filter messages by SQL92 in Apache RocketMQ.">
    <meta itemprop="datePublished" content="April 26, 2017">
    <meta itemprop="dateModified" content="April 27, 2017">

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Filter By SQL92 Example
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-file-text"></i> On This Page</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#principle" id="markdown-toc-principle">Principle</a></li>
  <li><a href="#grammars" id="markdown-toc-grammars">Grammars</a></li>
  <li><a href="#interface" id="markdown-toc-interface">Interface</a></li>
  <li><a href="#examples" id="markdown-toc-examples">Examples</a></li>
</ul>

  </nav>
</aside>

<p>In most cases, tag is simple and useful to select message as you want.For example:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">DefaultMQPushConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultMQPushConsumer</span><span class="o">(</span><span class="s">"CID_EXAMPLE"</span><span class="o">);</span>
<span class="n">consumer</span><span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="s">"TOPIC"</span><span class="o">,</span> <span class="s">"TAGA || TAGB || TAGC"</span><span class="o">);</span>
</code></pre>
</div>

<p>Consumer will recieve messages that contains TAGA or TAGB or TAGC. But the limitation is that one message only could has one tag, this may be not suitable for more sophisticated scenarios.At this time, you could use sql expression to select messages.</p>

<h3 id="principle">Principle</h3>

<p>SQL feature could do some calculation through the properties you put in messages when sending. Under the grammars defined by RocketMQ, you can implement some interesting logic as you want. Here is an example:</p>

<pre>
------------
| message  |
|----------|  a &gt; 5 AND b = 'abc'
| a = 10   |  --------------------&gt; Gotten
| b = 'abc'|
| c = true |
------------
------------
| message  |
|----------|   a &gt; 5 AND b = 'abc'
| a = 1    |  --------------------&gt; Missed
| b = 'abc'|
| c = true |
------------
</pre>

<h3 id="grammars">Grammars</h3>

<p>RocketMQ only defines some basic grammars to support this feature. Not enough ? You could also extend it easily.</p>

<ol>
  <li>Numeric comparison, like <code class="highlighter-rouge">&gt;</code>, <code class="highlighter-rouge">&gt;=</code>, <code class="highlighter-rouge">&lt;</code>, <code class="highlighter-rouge">&lt;=</code>, <code class="highlighter-rouge">BETWEEN</code>, <code class="highlighter-rouge">=</code>;</li>
  <li>Character comparison, like <code class="highlighter-rouge">=</code>, <code class="highlighter-rouge">&lt;&gt;</code>, <code class="highlighter-rouge">IN</code>;</li>
  <li><code class="highlighter-rouge">IS NULL</code> or <code class="highlighter-rouge">IS NOT NULL</code>;</li>
  <li>Logical <code class="highlighter-rouge">AND</code>, logical <code class="highlighter-rouge">OR</code>, logical <code class="highlighter-rouge">NOT</code>;</li>
</ol>

<p>Constant type are:</p>

<ol>
  <li>Numeric, like 123, 3.1415;</li>
  <li>Character, like ‘abc’, must be maked with single quotes;</li>
  <li><code class="highlighter-rouge">NULL</code>, special constant;</li>
  <li>Boolean, <code class="highlighter-rouge">TRUE</code> or <code class="highlighter-rouge">FALSE</code>;</li>
</ol>

<h3 id="interface">Interface</h3>

<p>Only push consumer could select messages by SQL92.The interface is:</p>

<p><code class="highlighter-rouge">public void subscribe(final String topic, final MessageSelector messageSelector)</code></p>

<h3 id="examples">Examples</h3>

<p>You can put properties in message through method <code class="highlighter-rouge">putUserProperty</code> when sending.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">DefaultMQProducer</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultMQProducer</span><span class="o">(</span><span class="s">"please_rename_unique_group_name"</span><span class="o">);</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">producer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MQClientException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Message</span><span class="o">(</span><span class="s">"TopicTest"</span><span class="o">,</span>
    <span class="n">tag</span><span class="o">,</span>
    <span class="o">(</span><span class="s">"Hello RocketMQ "</span> <span class="o">+</span> <span class="n">i</span><span class="o">).</span><span class="na">getBytes</span><span class="o">(</span><span class="n">RemotingHelper</span><span class="o">.</span><span class="na">DEFAULT_CHARSET</span><span class="o">)</span>
<span class="o">);</span>
<span class="c1">// Set some properties.</span>
<span class="n">msg</span><span class="o">.</span><span class="na">putUserProperty</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>

<span class="n">SendResult</span> <span class="n">sendResult</span> <span class="o">=</span> <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
   
<span class="n">producer</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</code></pre>
</div>

<p>Use <code class="highlighter-rouge">MessageSelector.bySql</code> to select messages through SQL92 when consuming.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">DefaultMQPushConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultMQPushConsumer</span><span class="o">(</span><span class="s">"please_rename_unique_group_name_4"</span><span class="o">);</span>

<span class="k">try</span> <span class="o">{</span>
	<span class="c1">// only subsribe messages have property a, also a &gt;=0 and a &lt;= 3</span>
    <span class="n">consumer</span><span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="s">"TopicTest"</span><span class="o">,</span> <span class="n">MessageSelector</span><span class="o">.</span><span class="na">bySql</span><span class="o">(</span><span class="s">"a between 0 and 3"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MQClientException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">consumer</span><span class="o">.</span><span class="na">registerMessageListener</span><span class="o">(</span><span class="k">new</span> <span class="n">MessageListenerConcurrently</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">ConsumeConcurrentlyStatus</span> <span class="nf">consumeMessage</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">MessageExt</span><span class="o">&gt;</span> <span class="n">msgs</span><span class="o">,</span> <span class="n">ConsumeConcurrentlyContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ConsumeConcurrentlyStatus</span><span class="o">.</span><span class="na">CONSUME_SUCCESS</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">});</span>
<span class="n">consumer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</code></pre>
</div>


        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-04-27">April 27, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=ApacheRocketMQ&text=Filter By SQL92 Example  /docs/filter-by-sql92-example/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=/docs/filter-by-sql92-example/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=/docs/filter-by-sql92-example/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=/docs/filter-by-sql92-example/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/docs/simple-example/" class="pagination--pager" title="Simple Message Example
">Previous</a>
    
    
      <a href="/docs/best-practice-broker/" class="pagination--pager" title="Best Practice For Broker
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <style type="text/css">
  div.columns   { float: left; margin-left: 10px;}
  div.clear     { clear: both; } 
</style>
<div>
  <div class="columns">
    <a href="https://www.apache.org/"><img src="/assets/images/feather-small.gif" alt="Apache Software Foundation" style="height: 88px !important" /></a>
  </div>
  <div class="columns" style="width: 80%">
    <div class="page__footer-follow">
      <ul class="social-icons">
        
          <li><strong>Follow:</strong></li>
        
        
          <li><a href="https://twitter.com/ApacheRocketMQ"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
        
        
          <li><a href="http://github.com/apache/incubator-rocketmq"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
        
        <li><a href="/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
      </ul>
    </div>

    <div class="page__footer-copyright">Copyright &copy; 2017 <a href="http://www.apache.org/">The Apache Software Foundation</a>. All Rights Reserved.</div>
  </div>
</div>
<div class="clear"></div>
      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89603173-1', 'auto');
  ga('send', 'pageview');
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?36428f2b841d08e7405724cbf7f860d2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'rocketmq';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
